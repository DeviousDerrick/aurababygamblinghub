<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Poker Casino Empire</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&display=swap" rel="stylesheet"/>
<style>
  :root {
    --purple-deep: #1a0d2e;
    --purple-mid: #2d1b4e;
    --purple-bright: #7b2cbf;
    --blue-bright: #00b4d8;
    --pink-neon: #f72585;
    --gold-bright: #ffd700;
    --white: #ffffff;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: linear-gradient(125deg, #1a0d2e 0%, #2d1b4e 25%, #3e1f5c 50%, #2d1b4e 75%, #1a0d2e 100%);
    background-size: 400% 400%;
    animation: gradientFlow 20s ease infinite;
    color: var(--white);
    padding: 20px;
    min-height: 100vh;
  }

  @keyframes gradientFlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.3;
    pointer-events: none;
    z-index: 0;
  }

  .orb1 {
    width: 500px;
    height: 500px;
    background: var(--purple-bright);
    top: -250px;
    left: -250px;
    animation: float 25s ease-in-out infinite;
  }

  .orb2 {
    width: 400px;
    height: 400px;
    background: var(--blue-bright);
    bottom: -200px;
    right: -200px;
    animation: float 30s ease-in-out infinite reverse;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(100px, -100px) scale(1.1); }
    66% { transform: translate(-100px, 100px) scale(0.9); }
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1800px;
    margin: 0 auto;
  }

  .header {
    text-align: center;
    margin-bottom: 30px;
  }

  .main-title {
    font-size: 2.5em;
    background: linear-gradient(135deg, var(--gold-bright), var(--pink-neon), var(--blue-bright));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: titleGlow 3s ease-in-out infinite;
    letter-spacing: 3px;
    margin-bottom: 15px;
  }

  @keyframes titleGlow {
    0%, 100% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
    50% { filter: drop-shadow(0 0 40px rgba(247,37,133,0.8)); }
  }

  .stats-row {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
  }

  .stat-display {
    font-size: 1.5em;
    padding: 10px 20px;
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.2);
    border-radius: 12px;
    color: var(--gold-bright);
    text-shadow: 0 0 20px rgba(255,215,0,0.8);
  }

  .main-content {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 30px;
  }

  .tables-container {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 28px;
    padding: 30px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }

  .tables-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .tables-title {
    font-size: 1.5em;
    background: linear-gradient(135deg, var(--white), var(--blue-bright));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tables-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    gap: 25px;
  }

  .table-card {
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.15);
    border-radius: 20px;
    padding: 20px;
    position: relative;
  }

  .table-card.empty {
    opacity: 0.3;
    border-style: dashed;
    text-align: center;
    padding: 60px 20px;
  }

  .table-title {
    text-align: center;
    font-size: 1em;
    color: var(--gold-bright);
    text-shadow: 0 0 10px var(--gold-bright);
    margin-bottom: 5px;
  }

  .table-stats {
    text-align: center;
    font-size: 0.7em;
    opacity: 0.8;
    margin-bottom: 10px;
  }

  .game-area {
    background: rgba(0,0,0,0.4);
    border: 2px solid rgba(255,255,255,0.2);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    min-height: 280px;
  }

  .community-cards {
    text-align: center;
    margin-bottom: 15px;
  }

  .community-label {
    font-size: 0.8em;
    color: var(--pink-neon);
    margin-bottom: 5px;
  }

  .hand-section {
    margin: 10px 0;
  }

  .hand-label {
    font-size: 0.8em;
    color: var(--blue-bright);
    margin-bottom: 5px;
  }

  .hand {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .card {
    width: 40px;
    height: 56px;
    background: white;
    color: black;
    font-weight: bold;
    border-radius: 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    font-size: 0.7em;
    line-height: 1.2;
  }

  .card.hearts, .card.diamonds { color: #ff0000; }
  .card.clubs, .card.spades { color: #000000; }

  .card.hidden {
    background: linear-gradient(135deg, #444, #222);
    color: #666;
  }

  .table-controls {
    display: flex;
    gap: 5px;
    margin-bottom: 10px;
  }

  .table-controls input {
    flex: 1;
    padding: 6px;
    font-size: 0.85em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: rgba(255,255,255,0.1);
    border: 2px solid var(--gold-bright);
    border-radius: 8px;
    color: var(--gold-bright);
    text-align: center;
  }

  .table-controls button {
    flex: 1;
    padding: 6px;
    font-size: 0.85em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: linear-gradient(135deg, var(--purple-bright), var(--pink-neon));
    color: var(--white);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(123,44,191,0.4);
    transition: all 0.3s ease;
  }

  .table-controls button:hover:not(:disabled) {
    transform: scale(1.05);
  }

  .table-controls button:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .remove-btn {
    width: 100%;
    padding: 6px;
    font-size: 0.8em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: rgba(255,0,0,0.3);
    color: #ff4444;
    border: 2px solid #ff4444;
    border-radius: 8px;
    cursor: pointer;
  }

  .table-message {
    text-align: center;
    font-size: 0.75em;
    min-height: 30px;
    margin-top: 5px;
  }

  .msg-win {
    color: var(--gold-bright);
    text-shadow: 0 0 10px var(--gold-bright);
  }

  .msg-lose {
    color: #ff4444;
  }

  .msg-tie {
    color: var(--blue-bright);
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .panel {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  }

  .panel-title {
    font-size: 1.3em;
    text-align: center;
    margin-bottom: 15px;
    background: linear-gradient(135deg, var(--blue-bright), var(--pink-neon));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .passives-list, .inventory-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 250px;
    overflow-y: auto;
  }

  .passive-item, .inventory-item {
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.15);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .passive-emoji, .inventory-emoji {
    font-size: 1.8em;
  }

  .passive-info, .inventory-info {
    flex: 1;
    font-size: 0.8em;
  }

  .passive-name, .inventory-name {
    color: var(--gold-bright);
    margin-bottom: 3px;
  }

  .passive-effect {
    opacity: 0.8;
    font-size: 0.9em;
  }

  .passive-level {
    color: var(--blue-bright);
    font-size: 0.85em;
  }

  .use-btn {
    padding: 6px 12px;
    font-size: 0.8em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: transparent;
    color: var(--blue-bright);
    border: 2px solid var(--blue-bright);
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 10px var(--blue-bright);
  }

  .use-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .shop-panel, .saves-panel {
    max-height: 500px;
    overflow-y: auto;
  }

  .shop-section-title {
    font-size: 1.1em;
    text-align: center;
    padding: 12px;
    margin: 10px 0;
    background: linear-gradient(135deg, var(--purple-bright), var(--pink-neon));
    border-radius: 12px;
  }

  .shop-item {
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.15);
    border-radius: 12px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .shop-item.maxed {
    opacity: 0.5;
    border-color: var(--gold-bright);
  }

  .shop-emoji {
    font-size: 2em;
  }

  .shop-info {
    flex: 1;
    font-size: 0.8em;
  }

  .shop-name {
    color: var(--gold-bright);
    margin-bottom: 3px;
  }

  .shop-stats {
    opacity: 0.8;
    font-size: 0.9em;
  }

  .shop-price {
    color: var(--blue-bright);
    margin-top: 3px;
  }

  .buy-btn {
    padding: 8px 16px;
    font-size: 0.85em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: linear-gradient(135deg, var(--blue-bright), var(--purple-bright));
    color: var(--white);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0,180,216,0.4);
  }

  .buy-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .save-slot {
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.15);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
  }

  .save-slot input {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    font-size: 0.9em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: rgba(255,255,255,0.1);
    border: 2px solid var(--blue-bright);
    border-radius: 8px;
    color: var(--white);
    text-align: center;
  }

  .save-slot-buttons {
    display: flex;
    gap: 10px;
  }

  .save-slot-buttons button {
    flex: 1;
    padding: 8px;
    font-size: 0.85em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    color: var(--white);
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  .save-slot-buttons .save-btn {
    background: linear-gradient(135deg, #4caf50, #2e7d32);
  }

  .save-slot-buttons .load-btn {
    background: linear-gradient(135deg, #ff9800, #e65100);
  }

  .reset-btn {
    width: 100%;
    padding: 12px;
    font-size: 1em;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: rgba(255,0,0,0.3);
    color: #ff4444;
    border: 2px solid #ff4444;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 15px;
  }

  @media (max-width: 1400px) {
    .main-content {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>

  <div class="container">
    <div class="header">
      <div class="main-title">üÉè POKER CASINO EMPIRE üÉè</div>
      <div class="stats-row">
        <div class="stat-display">
          üí∞ $<span id="money">1000</span>
        </div>
        <div class="stat-display">
          üìä Profit: $<span id="profit">0</span>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="tables-container">
        <div class="tables-header">
          <div class="tables-title">üé¥ ACTIVE POKER TABLES üé¥</div>
        </div>
        <div class="tables-grid" id="tablesGrid"></div>
      </div>

      <div class="sidebar">
        <div class="panel">
          <div class="panel-title">‚ö° PASSIVES ‚ö°</div>
          <div class="passives-list" id="passivesList"></div>
        </div>

        <div class="panel">
          <div class="panel-title">üìä STATS üìä</div>
          <div style="font-size: 0.85em;">
            <div style="margin-bottom: 8px;">Hands: <span id="hands" style="color: var(--gold-bright);">0</span></div>
            <div style="margin-bottom: 8px;">Wins: <span id="wins" style="color: #00ff00;">0</span></div>
            <div style="margin-bottom: 8px;">Losses: <span id="losses" style="color: #ff4444;">0</span></div>
            <div style="margin-bottom: 8px;">Royal Flushes: <span id="royalFlushes" style="color: var(--pink-neon);">üëë 0</span></div>
          </div>
          <button class="reset-btn" onclick="resetGame()">RESET GAME</button>
        </div>

        <div class="panel">
          <div class="panel-title">üéí INVENTORY üéí</div>
          <div class="inventory-list" id="inventoryList"></div>
        </div>

        <div class="panel saves-panel">
          <div class="panel-title">üíæ SAVE SLOTS üíæ</div>
          <div id="savesContainer"></div>
        </div>

        <div class="panel shop-panel">
          <div class="panel-title">üè™ SHOP üõí</div>
          <div id="shopGrid"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const TABLE_TYPES = {
      classic: {
        name: "CLASSIC POKER",
        emoji: "üé¥",
        payout: 2,
        ante: 1,
        cost: 0,
        description: "Standard Texas Hold'em, 2x payout"
      },
      highStakes: {
        name: "HIGH STAKES",
        emoji: "üíé",
        payout: 3,
        ante: 1.5,
        cost: 800,
        description: "Higher risk, 3x payout"
      },
      tournament: {
        name: "TOURNAMENT",
        emoji: "üèÜ",
        payout: 2.5,
        ante: 1,
        royalBonus: true,
        cost: 1200,
        description: "2.5x payout, royal flush bonus"
      },
      speed: {
        name: "SPEED POKER",
        emoji: "‚ö°",
        payout: 2.2,
        ante: 0.8,
        cost: 600,
        description: "Quick play, 2.2x payout"
      },
      fortune: {
        name: "FORTUNE POKER",
        emoji: "üí∞",
        payout: 5,
        ante: 2,
        royalBonus: true,
        cost: 3500,
        description: "Legendary 5x payout"
      }
    };

    const suits = ['‚ô•', '‚ô¶', '‚ô£', '‚ô†'];
    const suitNames = ['hearts', 'diamonds', 'clubs', 'spades'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

    let money = 1000;
    let totalProfit = 0;
    let activeTables = [null, null, null, null];
    let inventory = {};
    let betValues = {};
    let tableGames = {};
    let passives = {
      pokerFace: { owned: false, level: 0, maxLevel: 5 },
      cardSharp: { owned: false, level: 0, maxLevel: 5 },
      luckyDraw: { owned: false, level: 0, maxLevel: 3 },
      payoutMaster: { owned: false, level: 0, maxLevel: 5 },
      royalLuck: { owned: false, level: 0, maxLevel: 3 }
    };
    let stats = { hands: 0, wins: 0, losses: 0, royalFlushes: 0 };
    let saveSlots = JSON.parse(localStorage.getItem('pokerSaveSlots')) || [
      { name: 'Slot 1', data: null },
      { name: 'Slot 2', data: null },
      { name: 'Slot 3', data: null }
    ];

    function formatMoney(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return Math.floor(num).toString();
    }

    function createDeck() {
      const deck = [];
      for (let suit of suits) {
        for (let value of values) {
          deck.push({ value, suit });
        }
      }
      return deck.sort(() => Math.random() - 0.5);
    }

    function getCardValue(card) {
      if (card.value === 'A') return 14;
      if (card.value === 'K') return 13;
      if (card.value === 'Q') return 12;
      if (card.value === 'J') return 11;
      return parseInt(card.value);
    }

    function evaluateHand(cards) {
      const values = cards.map(c => getCardValue(c)).sort((a, b) => b - a);
      const suits = cards.map(c => c.suit);
      
      const isFlush = suits.every(s => s === suits[0]);
      const isStraight = values[0] - values[4] === 4 && new Set(values).size === 5;
      const isRoyalStraight = values.join(',') === '14,13,12,11,10';
      
      const valueCounts = {};
      values.forEach(v => valueCounts[v] = (valueCounts[v] || 0) + 1);
      const counts = Object.values(valueCounts).sort((a, b) => b - a);
      
      if (isFlush && isRoyalStraight) return { rank: 10, name: 'Royal Flush' };
      if (isFlush && isStraight) return { rank: 9, name: 'Straight Flush' };
      if (counts[0] === 4) return { rank: 8, name: 'Four of a Kind' };
      if (counts[0] === 3 && counts[1] === 2) return { rank: 7, name: 'Full House' };
      if (isFlush) return { rank: 6, name: 'Flush' };
      if (isStraight) return { rank: 5, name: 'Straight' };
      if (counts[0] === 3) return { rank: 4, name: 'Three of a Kind' };
      if (counts[0] === 2 && counts[1] === 2) return { rank: 3, name: 'Two Pair' };
      if (counts[0] === 2) return { rank: 2, name: 'Pair' };
      return { rank: 1, name: 'High Card' };
    }

    function getBestHand(playerCards, communityCards) {
      const allCards = [...playerCards, ...communityCards];
      let bestHand = { rank: 0 };
      
      // Check all 5-card combinations
      for (let i = 0; i < allCards.length; i++) {
        for (let j = i + 1; j < allCards.length; j++) {
          for (let k = j + 1; k < allCards.length; k++) {
            for (let l = k + 1; l < allCards.length; l++) {
              for (let m = l + 1; m < allCards.length; m++) {
                const hand = evaluateHand([allCards[i], allCards[j], allCards[k], allCards[l], allCards[m]]);
                if (hand.rank > bestHand.rank) bestHand = hand;
              }
            }
          }
        }
      }
      
      return bestHand;
    }

    function getPayout(tableType) {
      let payout = TABLE_TYPES[tableType].payout;
      if (passives.payoutMaster.owned) {
        payout *= (1 + 0.10 * passives.payoutMaster.level);
      }
      return payout;
    }

    function updateUI() {
      document.getElementById('money').textContent = formatMoney(money);
      document.getElementById('profit').textContent = formatMoney(Math.abs(totalProfit));
      document.getElementById('hands').textContent = stats.hands;
      document.getElementById('wins').textContent = stats.wins;
      document.getElementById('losses').textContent = stats.losses;
      document.getElementById('royalFlushes').textContent = stats.royalFlushes;
      
      renderTables();
      renderPassives();
      renderInventory();
      renderSaveSlots();
      renderShop();
    }

    function renderTables() {
      const grid = document.getElementById('tablesGrid');
      grid.innerHTML = '';

      activeTables.forEach((tableKey, index) => {
        const div = document.createElement('div');
        div.className = tableKey ? 'table-card' : 'table-card empty';

        if (tableKey) {
          const table = TABLE_TYPES[tableKey];
          const game = tableGames[index] || { state: 'ready' };
          
          div.innerHTML = `
            <div class="table-title">${table.emoji} ${table.name}</div>
            <div class="table-stats">${table.description}</div>
            <div class="game-area" id="game${index}">
              <div class="community-cards">
                <div class="community-label">üÉè Community Cards</div>
                <div class="hand" id="community${index}"></div>
              </div>
              <div class="hand-section">
                <div class="hand-label">üßç Your Hand</div>
                <div class="hand" id="phand${index}"></div>
              </div>
              <div class="hand-section">
                <div class="hand-label">ü§µ Dealer Hand</div>
                <div class="hand" id="dhand${index}"></div>
              </div>
            </div>
            <div class="table-controls">
              <input type="number" id="bet${index}" placeholder="Bet" value="${betValues[index] ?? 10}" 
                     oninput="betValues[${index}] = this.value" min="1" 
                     ${game.state !== 'ready' ? 'disabled' : ''} />
              <button onclick="dealCards(${index})" ${game.state !== 'ready' ? 'disabled' : ''}>DEAL</button>
            </div>
            <div class="table-controls">
              <button onclick="playHand(${index})" ${game.state !== 'playing' ? 'disabled' : ''}>PLAY</button>
              <button onclick="foldHand(${index})" ${game.state !== 'playing' ? 'disabled' : ''}>FOLD</button>
            </div>
            <button class="remove-btn" onclick="removeTable(${index})">REMOVE</button>
            <div class="table-message" id="msg${index}"></div>
          `;

          grid.appendChild(div);
          
          if (game.state !== 'ready') {
            setTimeout(() => renderHand(index), 100);
          }
        } else {
          div.innerHTML = '<div style="opacity: 0.5;">EMPTY SLOT<br>Add table from inventory</div>';
          grid.appendChild(div);
        }
      });
    }

    function renderHand(index) {
      const game = tableGames[index];
      if (!game) return;

      renderCards(`community${index}`, game.community, false);
      renderCards(`phand${index}`, game.player, false);
      renderCards(`dhand${index}`, game.dealer, !game.revealDealer);
    }

    function renderCards(elementId, cards, hidden) {
      const el = document.getElementById(elementId);
      if (!el) return;
      
      el.innerHTML = '';
      cards.forEach((card, i) => {
        const cardEl = document.createElement('div');
        if (hidden && i > 0) {
          cardEl.className = 'card hidden';
          cardEl.textContent = 'üÇ†';
        } else {
          const suitIndex = suits.indexOf(card.suit);
          cardEl.className = `card ${suitNames[suitIndex]}`;
          cardEl.innerHTML = `${card.value}<br>${card.suit}`;
        }
        el.appendChild(cardEl);
      });
    }

    function dealCards(index) {
      const tableKey = activeTables[index];
      if (!tableKey) return;

      const table = TABLE_TYPES[tableKey];
      const bet = parseInt(document.getElementById(`bet${index}`).value) || 0;
      const ante = Math.floor(bet * table.ante);
      
      if (ante <= 0 || ante > money) {
        showMessage(index, "‚õî Invalid bet!", 'lose');
        return;
      }

      money -= ante;
      stats.hands++;
      
      const deck = createDeck();
      
      tableGames[index] = {
        state: 'playing',
        bet: ante,
        deck: deck,
        player: [deck.pop(), deck.pop()],
        dealer: [deck.pop(), deck.pop()],
        community: [deck.pop(), deck.pop(), deck.pop()],
        revealDealer: false
      };

      updateUI();
    }

    function playHand(index) {
      const game = tableGames[index];
      const tableKey = activeTables[index];
      if (!game || game.state !== 'playing') return;

      // Player decides to play - must match the ante
      if (money < game.bet) {
        showMessage(index, "‚õî Not enough money!", 'lose');
        return;
      }

      money -= game.bet; // Match the bet
      
      // Reveal remaining community cards
      game.community.push(game.deck.pop());
      game.community.push(game.deck.pop());
      game.revealDealer = true;

      finishHand(index);
    }

    function foldHand(index) {
      const game = tableGames[index];
      if (!game || game.state !== 'playing') return;

      game.state = 'done';
      stats.losses++;
      totalProfit -= game.bet;
      
      showMessage(index, `üòì Folded! Lost $${game.bet}`, 'lose');
      
      setTimeout(() => {
        tableGames[index] = { state: 'ready' };
        updateUI();
      }, 2500);
      
      updateUI();
    }

    function finishHand(index) {
      const game = tableGames[index];
      const tableKey = activeTables[index];
      const table = TABLE_TYPES[tableKey];
      
      game.state = 'done';

      const playerHand = getBestHand(game.player, game.community);
      const dealerHand = getBestHand(game.dealer, game.community);

      renderHand(index);

      let result = '';
      let profit = 0;

      if (playerHand.rank > dealerHand.rank) {
        let payout = game.bet * 2 * getPayout(tableKey);
        
        if (playerHand.rank === 10 && table.royalBonus) {
          payout *= 2;
          stats.royalFlushes++;
        }
        
        money += payout;
        profit = payout - (game.bet * 2);
        stats.wins++;
        result = `üéâ ${playerHand.name}! Won $${formatMoney(payout)}`;
        showMessage(index, result, 'win');
      } else if (playerHand.rank < dealerHand.rank) {
        profit = -(game.bet * 2);
        stats.losses++;
        result = `üò¢ ${dealerHand.name} beats ${playerHand.name}`;
        showMessage(index, result, 'lose');
      } else {
        money += game.bet * 2; // Return both bets
        result = `ü§ù Tie - ${playerHand.name}`;
        showMessage(index, result, 'tie');
      }

      totalProfit += profit;
      
      setTimeout(() => {
        tableGames[index] = { state: 'ready' };
        updateUI();
      }, 4000);
      
      updateUI();
    }

    function showMessage(index, msg, type) {
      const msgEl = document.getElementById(`msg${index}`);
      if (msgEl) {
        msgEl.textContent = msg;
        msgEl.className = `table-message msg-${type}`;
      }
    }

    function renderPassives() {
      const list = document.getElementById('passivesList');
      list.innerHTML = '';

      const passiveConfigs = {
        pokerFace: { name: 'Poker Face', emoji: 'üòé', effect: '+10% better hands' },
        cardSharp: { name: 'Card Sharp', emoji: 'üÉè', effect: 'See dealer card' },
        luckyDraw: { name: 'Lucky Draw', emoji: 'üçÄ', effect: 'Better community cards' },
        payoutMaster: { name: 'Payout Master', emoji: 'üí∞', effect: '+10% payout per level' },
        royalLuck: { name: 'Royal Luck', emoji: 'üëë', effect: 'More royal flushes' }
      };

      let hasPassives = false;
      Object.entries(passives).forEach(([key, passive]) => {
        if (passive.owned) {
          hasPassives = true;
          const config = passiveConfigs[key];
          const div = document.createElement('div');
          div.className = 'passive-item';
          div.innerHTML = `
            <div class="passive-emoji">${config.emoji}</div>
            <div class="passive-info">
              <div class="passive-name">${config.name}</div>
              <div class="passive-effect">${config.effect}</div>
              ${passive.maxLevel > 1 ? `<div class="passive-level">Level ${passive.level}/${passive.maxLevel}</div>` : ''}
            </div>
          `;
          list.appendChild(div);
        }
      });

      if (!hasPassives) {
        list.innerHTML = '<div style="text-align: center; opacity: 0.5; padding: 20px; font-size: 0.85em;">No passives yet!</div>';
      }
    }

    function renderInventory() {
      const list = document.getElementById('inventoryList');
      list.innerHTML = '';

      let hasItems = false;
      Object.entries(inventory).forEach(([key, count]) => {
        if (count > 0) {
          hasItems = true;
          const table = TABLE_TYPES[key];
          const div = document.createElement('div');
          div.className = 'inventory-item';
          div.innerHTML = `
            <div class="inventory-emoji">${table.emoji}</div>
            <div class="inventory-info">
              <div class="inventory-name">${table.name}</div>
              <div>x${count} | ${table.payout}x payout</div>
            </div>
            <button class="use-btn" onclick="useFromInventory('${key}')" 
                    ${activeTables.filter(t => t === null).length === 0 ? 'disabled' : ''}>USE</button>
          `;
          list.appendChild(div);
        }
      });

      if (!hasItems) {
        list.innerHTML = '<div style="text-align:center;opacity:0.5;padding:20px;font-size:0.85em;">No tables in inventory</div>';
      }
    }

    function renderSaveSlots() {
      const container = document.getElementById('savesContainer');
      container.innerHTML = '';

      saveSlots.forEach((slot, i) => {
        const div = document.createElement('div');
        div.className = 'save-slot';
        div.innerHTML = `
          <input type="text" value="${slot.name}" onchange="updateSlotName(${i}, this.value)" />
          <div style="font-size: 0.8em; margin-bottom: 10px; opacity: 0.8;">
            ${slot.data ? `üíæ Saved: $${formatMoney(slot.data.money)}` : 'üìÇ Empty'}
          </div>
          <div class="save-slot-buttons">
            <button class="save-btn" onclick="saveToSlot(${i})">SAVE</button>
            <button class="load-btn" onclick="loadFromSlot(${i})" ${!slot.data ? 'disabled' : ''}>LOAD</button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function updateSlotName(index, name) {
      saveSlots[index].name = name || `Slot ${index + 1}`;
      localStorage.setItem('pokerSaveSlots', JSON.stringify(saveSlots));
    }

    function saveToSlot(index) {
      saveSlots[index].data = {
        money,
        totalProfit,
        activeTables: activeTables.slice(),
        inventory: {...inventory},
        passives: JSON.parse(JSON.stringify(passives)),
        stats: {...stats}
      };
      localStorage.setItem('pokerSaveSlots', JSON.stringify(saveSlots));
      alert(`Saved to ${saveSlots[index].name}!`);
      renderSaveSlots();
    }

    function loadFromSlot(index) {
      const data = saveSlots[index].data;
      if (!data) {
        alert('Empty slot!');
        return;
      }
      
      money = data.money;
      totalProfit = data.totalProfit;
      activeTables = data.activeTables.slice();
      inventory = {...data.inventory};
      passives = JSON.parse(JSON.stringify(data.passives));
      stats = {...data.stats};
      tableGames = {};
      
      alert(`Loaded ${saveSlots[index].name}!`);
      updateUI();
    }

    function renderShop() {
      const grid = document.getElementById('shopGrid');
      grid.innerHTML = '';

      // Tables
      const tablesTitle = document.createElement('div');
      tablesTitle.className = 'shop-section-title';
      tablesTitle.textContent = 'üÉè POKER TABLES üé¥';
      grid.appendChild(tablesTitle);

      Object.entries(TABLE_TYPES).forEach(([key, table]) => {
        const div = document.createElement('div');
        div.className = 'shop-item';
        div.innerHTML = `
          <div class="shop-emoji">${table.emoji}</div>
          <div class="shop-info">
            <div class="shop-name">${table.name}</div>
            <div class="shop-stats">${table.description}</div>
            <div class="shop-price">$${formatMoney(table.cost)}</div>
          </div>
          <button class="buy-btn" onclick="buyTable('${key}')" ${money < table.cost ? 'disabled' : ''}>BUY</button>
        `;
        grid.appendChild(div);
      });

      // Passives
      const passivesTitle = document.createElement('div');
      passivesTitle.className = 'shop-section-title';
      passivesTitle.textContent = '‚ö° PASSIVES ‚ö°';
      grid.appendChild(passivesTitle);

      const passiveShop = [
        { key: 'pokerFace', name: 'Poker Face', emoji: 'üòé', baseCost: 1200, costMultiplier: 2, effect: '+10% better hands', maxLevel: 5 },
        { key: 'cardSharp', name: 'Card Sharp', emoji: 'üÉè', baseCost: 1500, costMultiplier: 2, effect: 'See dealer card', maxLevel: 5 },
        { key: 'luckyDraw', name: 'Lucky Draw', emoji: 'üçÄ', baseCost: 1800, costMultiplier: 2, effect: 'Better cards', maxLevel: 3 },
        { key: 'payoutMaster', name: 'Payout Master', emoji: 'üí∞', baseCost: 2500, costMultiplier: 3, effect: '+10% payout', maxLevel: 5 },
        { key: 'royalLuck', name: 'Royal Luck', emoji: 'üëë', baseCost: 3000, costMultiplier: 2.5, effect: 'More royals', maxLevel: 3 }
      ];

      passiveShop.forEach(passive => {
        const current = passives[passive.key];
        const currentLevel = current.level || 0;
        const canUpgrade = currentLevel < passive.maxLevel;
        const cost = Math.floor(passive.baseCost * Math.pow(passive.costMultiplier, currentLevel));
        
        const div = document.createElement('div');
        div.className = `shop-item ${!canUpgrade ? 'maxed' : ''}`;
        div.innerHTML = `
          <div class="shop-emoji">${passive.emoji}</div>
          <div class="shop-info">
            <div class="shop-name">${passive.name}</div>
            <div class="shop-stats">${passive.effect}</div>
            ${passive.maxLevel > 1 ? `<div class="shop-stats">Level: ${currentLevel}/${passive.maxLevel}</div>` : ''}
            ${canUpgrade ? `<div class="shop-price">$${formatMoney(cost)}</div>` : '<div class="shop-price">MAX</div>'}
          </div>
          ${canUpgrade ? `
            <button class="buy-btn" onclick="buyPassive('${passive.key}', ${cost})" 
                    ${money < cost ? 'disabled' : ''}>${current.owned ? 'UPGRADE' : 'BUY'}</button>
          ` : '<button class="buy-btn" disabled>MAXED</button>'}
        `;
        grid.appendChild(div);
      });
    }

    function buyTable(key) {
      const table = TABLE_TYPES[key];
      if (money >= table.cost) {
        money -= table.cost;
        inventory[key] = (inventory[key] || 0) + 1;
        updateUI();
      }
    }

    function buyPassive(passiveKey, cost) {
      if (money >= cost) {
        money -= cost;
        passives[passiveKey].owned = true;
        passives[passiveKey].level = (passives[passiveKey].level || 0) + 1;
        updateUI();
      }
    }

    function useFromInventory(key) {
      const emptyIndex = activeTables.findIndex(t => t === null);
      if (emptyIndex !== -1 && inventory[key] > 0) {
        activeTables[emptyIndex] = key;
        inventory[key]--;
        tableGames[emptyIndex] = { state: 'ready' };
        updateUI();
      }
    }

    function removeTable(index) {
      const tableKey = activeTables[index];
      if (tableKey) {
        inventory[tableKey] = (inventory[tableKey] || 0) + 1;
        activeTables[index] = null;
        delete tableGames[index];
        updateUI();
      }
    }

    function resetGame() {
      if (confirm('Reset game? All progress will be lost!')) {
        money = 1000;
        totalProfit = 0;
        activeTables = [null, null, null, null];
        inventory = {};
        betValues = {};
        tableGames = {};
        passives = {
          pokerFace: { owned: false, level: 0, maxLevel: 5 },
          cardSharp: { owned: false, level: 0, maxLevel: 5 },
          luckyDraw: { owned: false, level: 0, maxLevel: 3 },
          payoutMaster: { owned: false, level: 0, maxLevel: 5 },
          royalLuck: { owned: false, level: 0, maxLevel: 3 }
        };
        stats = { hands: 0, wins: 0, losses: 0, royalFlushes: 0 };
        updateUI();
      }
    }

    updateUI();
  </script>
</body>
</html>
